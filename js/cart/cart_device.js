jQuery(document).ready(function(d){var r=d(".cd-cart-container");var n=0;if(localStorage.login){d.ajax({url:"/admin/modules/php/route.php",dataType:"json",data:{type:"login",data:localStorage.login},type:"POST",cache:false,success:function(w){if(w){d("#reg_").hide();d("#log_").show();d("#reg_mobile").hide();d("#log_mobile").hide();d("#lk_mobile").show();d("#logout_mobile").show();if(w.cart.length>0){var v=[];w.cart.map(function(y){var x=1;if(parseInt(y.count)<=0){x=1}else{x=y.count}v=v.concat({id:y.item_id,count:x})});localStorage.myCart=JSON.stringify(v)}else{localStorage.myCart=""}}}.bind(this)})}var t=localStorage.myCart?JSON.parse(localStorage.myCart):[];setTimeout(function(){t=localStorage.myCart?JSON.parse(localStorage.myCart):[];d.ajax({url:"/admin/modules/php/route.php",dataType:"json",data:{type:"get_items_from_my_cart",items:t},type:"POST",cache:false,success:function(x){if(x){var w=0,v=0;x.map(function(A){var C=r.hasClass("empty"),B=document.getElementsByClassName("product"),y=false;for(var z=0;B[z];z++){if(B[z].dataset.id==A.id){y=true}}if(!y){t.map(function(D){if(D.id==A.id){var E=1;if(parseInt(D.count)<=parseInt(0)){E=1}else{E=D.count}p(A.id,A.name,E,A.price);w+=parseFloat(A.price)*parseInt(E);v+=parseInt(E);l(C,parseInt(E))}});g(A.price,true);r.removeClass("empty")}});m.text(w.toFixed(2))}}.bind(this)})},1000);if(r.length>0){var j=r.find(".body"),q=j.find("ul").eq(0),m=r.find(".checkout").find("span"),c=r.children(".cd-cart-trigger"),u=c.children(".count"),k=d(".cd-add-to-cart"),s=r.find(".undo"),f;k.on("click",function(v){v.preventDefault();o(d(this))});c.on("click",function(v){v.preventDefault();b()});r.on("click",function(v){if(d(v.target).is(d(this))){b(true)}});q.on("click",".delete-item",function(v){v.preventDefault();e(d(v.target).parents(".product"))});q.on("change","select",function(v){i()});s.on("click","a",function(v){clearInterval(f);v.preventDefault();q.find(".deleted").addClass("undo-deleted").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){d(this).off("webkitAnimationEnd oanimationend msAnimationEnd animationend").removeClass("deleted undo-deleted").removeAttr("style");i()});s.removeClass("visible")})}function b(v){var w=(typeof v==="undefined")?r.hasClass("cart-open"):v;if(w){r.removeClass("cart-open");clearInterval(f);s.removeClass("visible");q.find(".deleted").remove();setTimeout(function(){j.scrollTop(0);if(Number(u.find("li").eq(0).text())==0){r.addClass("empty")}},500)}else{r.addClass("cart-open")}}function o(w){var z=r.hasClass("empty");var y=document.getElementsByClassName("product"),v=false;for(var x=0;y[x];x++){if(y[x].dataset.id==w.data("id")){v=true}}if(!v){h(w);l(z);g(w.data("price"),true);r.removeClass("empty")}}function h(w){if(localStorage.login){d.ajax({url:"/admin/modules/php/route.php",data:{type:"add_to_cart",login:localStorage.login,item_id:w.data("id")},type:"POST",cache:false,success:function(x){console.log(x)}.bind(this)})}t=localStorage.myCart?JSON.parse(localStorage.myCart):[];t=t.concat({id:w.data("id"),count:1});localStorage.myCart=JSON.stringify(t);var v=d('<li class="product" data-id="'+w.data("id")+'"><input type="hidden" class="item_id" value="'+w.data("id")+'" /><div class="product-image"><a href="/item/'+w.data("id")+'"><img src="'+w.data("photo")+'" alt="placeholder"></a></div><div class="product-details"><span class="h3" style="margin: 0px;"><a href="/item/'+w.data("id")+'">'+w.data("name")+'</a></span><span class="price" style="font-size: 2rem;">'+w.data("price")+'</span> <i class="fa fa-rub"></i><div class="actions"><a href="#0" class="delete-item">Удалить</a></div></div></li>');q.prepend(v)}function p(z,v,y,x){var w=d('<li class="product" data-id="'+z+'"><input type="hidden" class="item_id" value="'+z+'" /><div class="product-image"><a href="/item/'+z+'"><img src="/img/items/'+z+'_main.jpg" alt="placeholder"></a></div><div class="product-details"><span class="h3" style="margin: 0px;"><a href="/item/'+z+'">'+v+'</a></span><span class="price" style="font-size: 2rem;">'+x+'</span> <i class="fa fa-rub"></i><div class="actions"><a href="#0" class="delete-item">Удалить</a></div></div></li>');q.prepend(w);d("#cd-product-"+z).val(y)}function e(x){clearInterval(f);q.find(".deleted").remove();var z=x.find(".item_id").val();var w=x.offset().top-j.children("ul").offset().top,v=Number(x.find(".quantity").find("select").val()),y=Number(x.find(".price").text().replace("$",""))*v;x.css("top",w+"px").addClass("deleted");g(y,false);l(true,-v);s.addClass("visible");f=setTimeout(function(){s.removeClass("visible");q.find(".deleted").remove();t=localStorage.myCart?JSON.parse(localStorage.myCart):[];var A=[];t.map(function(B){if(B.id!=z){A=A.concat(B)}});if(localStorage.login){d.ajax({url:"/admin/modules/php/route.php",data:{type:"kill_item_from_cart",login:localStorage.login,item_id:z},type:"POST",cache:false,success:function(B){console.log(B)}.bind(this)})}localStorage.myCart=JSON.stringify(A)},700)}function i(){var x=0;var v=0;t=localStorage.myCart?JSON.parse(localStorage.myCart):[];var w=[];q.children("li:not(.deleted)").each(function(){var z=Number(d(this).find("select").val());var A=d(this).find(".item_id").val(),y=d(this).find("select").val();if(localStorage.login){d.ajax({url:"/admin/modules/php/route.php",data:{type:"kill_from_cart",login:localStorage.login,item_id:A,count:y},type:"POST",cache:false,success:function(B){console.log(B)}.bind(this)})}t.map(function(B){if(B.id==A){w=w.concat({id:B.id,count:y})}});x=x+z;v=v+z*Number(d(this).find(".price").text().replace("$",""))});localStorage.myCart=JSON.stringify(w);m.text(v.toFixed(2));u.find("li").eq(0).text(x);u.find("li").eq(1).text(x+1)}function l(v,x){if(typeof x==="undefined"){var y=Number(u.find("li").eq(0).text())+1;var w=y+1;if(v){u.find("li").eq(0).text(y);u.find("li").eq(1).text(w)}else{u.addClass("update-count");setTimeout(function(){u.find("li").eq(0).text(y)},150);setTimeout(function(){u.removeClass("update-count")},200);setTimeout(function(){u.find("li").eq(1).text(w)},230)}}else{var y=Number(u.find("li").eq(0).text())+x;var w=y+1;u.find("li").eq(0).text(y);u.find("li").eq(1).text(w)}}function g(w,v){v?m.text((Number(m.text())+Number(w)).toFixed(2)):m.text((Number(m.text())-Number(w)).toFixed(2))}function a(v,w){return w.search(v)!=-1?true:false}d(document).on("keyup","#search_items",function(){var x=d("#search_items").val(),v=document.getElementsByClassName("this_items");for(var w=0;v[w];w++){if(!a(x.toLowerCase(),v[w].dataset.name.toLowerCase()+" "+v[w].dataset.art.toLowerCase())){d(".thisId_"+v[w].dataset.id).addClass("toHide")}else{d(".thisId_"+v[w].dataset.id).removeClass("toHide")}}})});